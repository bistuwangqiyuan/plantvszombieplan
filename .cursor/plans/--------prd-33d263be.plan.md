<!-- 33d263be-2cdb-487a-9821-40f91ac9eea1 f86f5dcc-6758-49e1-8937-19c761458afe -->
# 竖屏植物大战僵尸游戏 PRD 文档

## 一、产品概述

### 1.1 产品名称

plantvszombieastro - 竖屏网页版植物大战僵尸

### 1.2 产品定位

一款适配竖屏显示的网页版塔防游戏，玩家通过种植各种植物来抵御僵尸入侵。游戏设计简洁流畅，支持PC和移动设备访问，无需注册登录即可畅玩。

### 1.3 目标用户

- 喜欢休闲塔防游戏的个人玩家
- 移动端用户（主要使用场景）
- 希望快速上手、无需复杂操作的轻度游戏玩家

### 1.4 核心特色

- 竖屏设计，适配手机操作
- 无需注册，打开即玩
- 本地存储进度，数据安全
- 简化版游戏机制，快速上手
- 完全免费，无广告干扰

## 二、功能需求详细设计

### 2.1 页面结构

游戏采用单页面应用（SPA）设计，所有内容在 `index.html` 中完成。页面包含以下状态：

#### 2.1.1 主菜单界面

**显示内容：**

- 游戏标题："植物大战僵尸"（大标题，艺术字体）
- 副标题："竖屏版"
- 开始游戏按钮
- 关卡选择按钮
- 游戏说明按钮
- 重置进度按钮（小字提示）
- 背景：草地+天空的卡通风格

**交互逻辑：**

- 点击"开始游戏"：进入当前可玩的最新关卡
- 点击"关卡选择"：显示关卡列表，已完成关卡可重新挑战
- 点击"游戏说明"：弹出游戏规则和操作指引
- 点击"重置进度"：弹出确认框，确认后清空localStorage中的进度数据

#### 2.1.2 关卡选择界面

**显示内容：**

- 标题："选择关卡"
- 关卡列表（纵向排列）：
  - 关卡1：阳光草地（始终可选）
  - 关卡2：僵尸来袭（需完成关卡1解锁）
  - 关卡3：坚果防线（需完成关卡2解锁）
  - 关卡4：冰冻时刻（需完成关卡3解锁）
  - 关卡5：终极对决（需完成关卡4解锁）
- 每个关卡卡片显示：
  - 关卡编号和名称
  - 解锁状态（已解锁/未解锁）
  - 完成状态（已完成显示星标）
  - 关卡特色描述（一句话）
- 返回按钮

**交互逻辑：**

- 点击已解锁关卡：进入关卡准备界面
- 点击未解锁关卡：提示"请先完成前面的关卡"
- 点击返回：回到主菜单

#### 2.1.3 关卡准备界面

**显示内容：**

- 关卡名称和编号
- 关卡目标说明（例如："消灭20个僵尸"）
- 可用植物展示区（横向卡片列表）：
  - 植物图标（用emoji或CSS绘制）
  - 植物名称
  - 阳光消耗
  - 冷却时间
  - 植物能力简介
- 开始游戏按钮
- 返回关卡选择按钮

**交互逻辑：**

- 点击植物卡片：显示植物详细信息
- 点击"开始游戏"：进入游戏战斗界面
- 点击"返回"：回到关卡选择界面

#### 2.1.4 游戏战斗界面（核心界面）

**布局设计（竖屏优化）：**

```
┌─────────────────────┐
│  顶部状态栏          │ ← 阳光数量、关卡进度、暂停按钮
├─────────────────────┤
│  植物选择栏          │ ← 可种植植物卡片（横向滚动）
├─────────────────────┤
│                     │
│                     │
│    游戏战场区域      │ ← 5行×3列的格子（或4行×3列）
│    （网格布局）      │   僵尸从右侧进入，向左移动
│                     │   到达左侧边界则游戏失败
│                     │
│                     │
├─────────────────────┤
│  底部提示区          │ ← 操作提示、波次提示
└─────────────────────┘
```

**顶部状态栏（固定）：**

- 阳光计数器：显示当前阳光数量，数字+太阳图标
- 关卡进度：显示当前波次/总波次（例如："2/5波"）
- 暂停按钮：点击暂停游戏并弹出菜单

**植物选择栏（固定）：**

- 横向滚动卡片列表
- 每个植物卡片显示：
  - 植物图标
  - 阳光消耗
  - 冷却进度条（冷却中显示灰色蒙层+倒计时）
- 阳光不足时卡片变暗+显示"阳光不足"
- 点击选中植物后，卡片高亮，进入种植模式

**游戏战场区域（可滚动）：**

- 网格布局：5行×3列（共15个格子）
- 每个格子：
  - 草地背景
  - 可容纳1个植物
  - 已有植物时显示植物图标和生命值条
- 僵尸从屏幕右侧生成，沿行向左移动
- 僵尸碰到植物会攻击，消灭后继续前进
- 僵尸到达左侧边界游戏失败

**底部提示区（固定）：**

- 操作提示："点击植物后点击格子种植"
- 波次提醒："下一波僵尸即将到来！"
- 特殊提示："一大波僵尸正在接近！"

**交互逻辑：**

1. **种植植物：**

   - 点击植物选择栏中的植物卡片（阳光充足且未冷却）
   - 战场格子显示半透明预览
   - 点击空格子确认种植
   - 扣除阳光，植物进入冷却，格子生成植物
   - 点击其他植物卡片或战场外取消选择

2. **移除植物：**

   - 长按已种植的植物1秒
   - 弹出确认框："是否移除此植物？"
   - 确认后植物消失，该格子变为空格子
   - 不返还阳光（战略选择的代价）

3. **阳光收集：**

   - 战场上每隔10秒自动掉落一个太阳
   - 种植向日葵后，向日葵每15秒生成一个太阳
   - 太阳在生成位置停留8秒后消失
   - 点击太阳，太阳飞向顶部阳光计数器，阳光+25或+50

4. **植物攻击：**

   - 豌豆射手：每2秒向右侧发射一个豌豆
   - 豌豆飞行速度恒定，碰到僵尸造成伤害并消失
   - 寒冰射手：每2.5秒发射冰豌豆，命中僵尸造成伤害并减速
   - 樱桃炸弹：种植后3秒爆炸，消灭周围3×3范围内所有僵尸

5. **僵尸行为：**

   - 普通僵尸：缓慢前进，碰到植物停下攻击
   - 路障僵尸：血量更高，移动速度相同
   - 铁桶僵尸：血量极高，移动速度较快
   - 僵尸攻击频率：每1秒对当前格子的植物造成伤害
   - 植物生命值归零后消失，僵尸继续前进

6. **游戏进程：**

   - 游戏分为5波僵尸
   - 第1波：3个普通僵尸
   - 第2波：5个普通僵尸
   - 第3波：4个普通僵尸 + 2个路障僵尸
   - 第4波：6个普通僵尸 + 2个路障僵尸
   - 第5波：5个普通僵尸 + 3个路障僵尸 + 1个铁桶僵尸
   - 每波之间间隔20秒准备时间
   - 消灭所有僵尸且没有僵尸越界则胜利

7. **暂停菜单：**

   - 点击暂停按钮，游戏时间停止，弹出半透明遮罩
   - 显示选项：
     - 继续游戏
     - 重新开始本关
     - 返回主菜单
   - 选择后执行相应操作

#### 2.1.5 游戏结果界面

**胜利界面：**

- 大标题："胜利！"
- 动画效果：向日葵跳舞
- 显示数据：
  - 消灭僵尸数量
  - 损失植物数量
  - 剩余阳光数量
- 奖励提示："解锁下一关卡！"（如有）
- 按钮：
  - 下一关（如已解锁）
  - 重玩本关
  - 返回主菜单

**失败界面：**

- 大标题："失败了..."
- 失败原因："僵尸吃掉了你的脑子！"
- 失败提示：
  - "尝试种植更多的豌豆射手"
  - "使用坚果墙保护射手"
  - "及时收集阳光"
- 按钮：
  - 重新挑战
  - 返回主菜单

#### 2.1.6 游戏说明界面

**显示内容（弹窗或独立页面）：**

**游戏目标：**

- 种植植物抵御僵尸入侵
- 阻止僵尸到达屏幕左侧
- 消灭所有僵尸波次获得胜利

**基础操作：**

1. 点击植物卡片选择植物
2. 点击战场格子种植植物
3. 点击掉落的太阳收集阳光
4. 长按植物可移除（不返还阳光）

**植物介绍：**

- **向日葵（50阳光）：** 定期生产阳光，是经济来源
- **豌豆射手（100阳光）：** 发射豌豆攻击僵尸，基础攻击单位
- **坚果墙（50阳光）：** 高血量防御植物，保护后方射手
- **寒冰射手（175阳光）：** 发射冰豌豆，减缓僵尸速度
- **樱桃炸弹（150阳光）：** 一次性爆炸，消灭范围内僵尸

**僵尸介绍：**

- **普通僵尸：** 基础僵尸，血量低，速度慢
- **路障僵尸：** 戴着路障，血量中等
- **铁桶僵尸：** 戴着铁桶，血量高，速度快

**游戏技巧：**

- 前期优先种植向日葵积累阳光
- 每行至少放置一个攻击性植物
- 使用坚果墙延缓僵尸前进
- 合理使用樱桃炸弹应对大波僵尸
- 及时收集阳光，不要浪费

**关闭按钮：** 返回主菜单

### 2.2 关卡设计详细配置

#### 关卡1：阳光草地

- **解锁条件：** 无（初始关卡）
- **关卡目标：** 消灭15个僵尸
- **可用植物：** 向日葵、豌豆射手、坚果墙
- **僵尸配置：**
  - 第1波：2个普通僵尸（行1、行3）
  - 第2波：3个普通僵尸（行1、行2、行4）
  - 第3波：4个普通僵尸（行2、行3、行4、行5）
  - 第4波：3个普通僵尸 + 1个路障僵尸
  - 第5波：2个普通僵尸 + 1个路障僵尸
- **波次间隔：** 25秒
- **初始阳光：** 150
- **难度：** 简单
- **通关奖励：** 解锁关卡2，解锁寒冰射手

#### 关卡2：僵尸来袭

- **解锁条件：** 完成关卡1
- **关卡目标：** 消灭25个僵尸
- **可用植物：** 向日葵、豌豆射手、坚果墙、寒冰射手
- **僵尸配置：**
  - 第1波：4个普通僵尸
  - 第2波：5个普通僵尸 + 1个路障僵尸
  - 第3波：4个普通僵尸 + 2个路障僵尸
  - 第4波：3个普通僵尸 + 3个路障僵尸
  - 第5波：4个普通僵尸 + 3个路障僵尸 + 1个铁桶僵尸
- **波次间隔：** 20秒
- **初始阳光：** 100
- **难度：** 中等
- **通关奖励：** 解锁关卡3，解锁樱桃炸弹

#### 关卡3：坚果防线

- **解锁条件：** 完成关卡2
- **关卡目标：** 消灭30个僵尸，不能让僵尸越过中线（第2列）
- **可用植物：** 向日葵、豌豆射手、坚果墙（冷却减半）、寒冰射手、樱桃炸弹
- **僵尸配置：**
  - 第1波：6个普通僵尸（快速生成）
  - 第2波：5个普通僵尸 + 2个路障僵尸
  - 第3波：4个普通僵尸 + 3个路障僵尸 + 1个铁桶僵尸
  - 第4波：6个普通僵尸 + 2个路障僵尸 + 1个铁桶僵尸
  - 第5波：5个普通僵尸 + 3个路障僵尸 + 2个铁桶僵尸
- **波次间隔：** 15秒
- **初始阳光：** 150
- **难度：** 中等偏难
- **特殊机制：** 僵尸生成速度加快，坚果墙冷却时间减半
- **通关奖励：** 解锁关卡4

#### 关卡4：冰冻时刻

- **解锁条件：** 完成关卡3
- **关卡目标：** 消灭35个僵尸，必须使用寒冰射手
- **可用植物：** 向日葵、寒冰射手（阳光消耗降为125）、坚果墙、樱桃炸弹
- **僵尸配置：**
  - 第1波：5个路障僵尸
  - 第2波：6个路障僵尸 + 1个铁桶僵尸
  - 第3波：4个普通僵尸 + 4个路障僵尸 + 1个铁桶僵尸
  - 第4波：5个路障僵尸 + 2个铁桶僵尸
  - 第5波：6个路障僵尸 + 3个铁桶僵尸
- **波次间隔：** 18秒
- **初始阳光：** 125
- **难度：** 困难
- **特殊机制：** 不能使用豌豆射手，寒冰射手阳光消耗降低，僵尸整体血量提升
- **通关奖励：** 解锁关卡5

#### 关卡5：终极对决

- **解锁条件：** 完成关卡4
- **关卡目标：** 消灭50个僵尸，存活10波攻击
- **可用植物：** 全部植物，所有植物冷却时间减少30%
- **僵尸配置：**
  - 第1-2波：每波5个普通僵尸
  - 第3-4波：每波4个普通僵尸 + 2个路障僵尸
  - 第5-6波：每波3个普通僵尸 + 3个路障僵尸 + 1个铁桶僵尸
  - 第7-8波：每波4个路障僵尸 + 2个铁桶僵尸
  - 第9波：6个路障僵尸 + 3个铁桶僵尸
  - 第10波：8个普通僵尸 + 5个路障僵尸 + 3个铁桶僵尸（最终波）
- **波次间隔：** 12秒
- **初始阳光：** 200
- **难度：** 极难
- **特殊机制：** 波次增加到10波，僵尸生成频率高，第10波为超大波
- **通关奖励：** 游戏通关，显示"恭喜通关！"

### 2.3 植物详细属性

| 植物名称 | 阳光消耗 | 冷却时间 | 生命值 | 攻击力 | 攻击间隔 | 特殊能力 | 解锁关卡 |

|---------|---------|---------|--------|--------|---------|---------|---------|

| 向日葵 | 50 | 5秒 | 100 | 0 | - | 每15秒生产50阳光 | 关卡1 |

| 豌豆射手 | 100 | 5秒 | 150 | 20 | 2秒 | 向右发射豌豆 | 关卡1 |

| 坚果墙 | 50 | 20秒 | 600 | 0 | - | 高血量防御 | 关卡1 |

| 寒冰射手 | 175 | 7秒 | 150 | 20 | 2.5秒 | 发射冰豌豆，减速50% | 关卡2 |

| 樱桃炸弹 | 150 | 30秒 | 50 | 1800 | 3秒后爆炸 | 3×3范围爆炸，一次性 | 关卡3 |

### 2.4 僵尸详细属性

| 僵尸名称 | 生命值 | 移动速度 | 攻击力 | 攻击间隔 | 出现关卡 |

|---------|--------|---------|--------|---------|---------|

| 普通僵尸 | 200 | 30像素/秒 | 20 | 1秒 | 关卡1+ |

| 路障僵尸 | 500 | 30像素/秒 | 20 | 1秒 | 关卡1+ |

| 铁桶僵尸 | 1200 | 40像素/秒 | 30 | 0.8秒 | 关卡2+ |

### 2.5 数据存储设计（localStorage）

使用localStorage存储游戏进度，键值对设计如下：

```javascript
// 存储键名
const STORAGE_KEY = 'pvz_game_data';

// 数据结构
{
  version: '1.0',  // 数据版本，用于未来升级兼容
  lastUpdate: 1696752000000,  // 最后更新时间戳
  progress: {
    currentLevel: 1,  // 当前可玩的关卡（1-5）
    completedLevels: [1, 2],  // 已完成的关卡数组
    unlockedPlants: ['sunflower', 'peashooter', 'wallnut', 'snowpea'],  // 已解锁植物
  },
  settings: {
    soundEnabled: true,  // 音效开关（预留）
    musicEnabled: true,  // 音乐开关（预留）
  },
  stats: {
    totalGames: 25,  // 总游戏次数
    totalWins: 18,  // 总胜利次数
    totalZombiesKilled: 523,  // 总消灭僵尸数
  }
}
```

**存储操作封装：**

- `saveGameData(data)`: 保存游戏数据
- `loadGameData()`: 读取游戏数据，返回对象或null
- `resetGameData()`: 清空游戏数据
- `updateProgress(level)`: 更新关卡进度
- `unlockPlant(plantId)`: 解锁新植物

## 三、技术方案设计

### 3.1 技术栈选择

**前端技术：**

- HTML5：页面结构
- CSS3：样式、动画、响应式布局
- JavaScript（原生ES6+）：游戏逻辑、交互控制
- Bootstrap 5.3：UI组件、栅格系统、按钮样式（CDN引入）

**无后端架构：**

- 所有数据使用localStorage本地存储
- 无需服务器端交互
- 纯静态网站，适合Netlify部署

**开发工具：**

- 文本编辑器（VS Code）
- 浏览器开发者工具
- Git版本控制

### 3.2 文件结构设计

```
plantvszombieastro/
├── index.html          # 主页面（包含所有HTML结构）
├── style.css           # 全局样式和游戏样式
├── game.js             # 游戏核心逻辑
├── plants.js           # 植物类和相关逻辑
├── zombies.js          # 僵尸类和相关逻辑
├── levels.js           # 关卡配置数据
├── storage.js          # localStorage存储管理
├── ui.js               # UI界面控制和切换
├── assets/             # 资源文件夹
│   ├── images/         # 图片资源（可选）
│   └── sounds/         # 音效文件（预留）
├── .gitignore          # Git忽略文件
├── netlify.toml        # Netlify配置文件
└── README.md           # 项目说明文档
```

**文件职责说明：**

1. **index.html：** 

   - 定义所有页面结构和布局
   - 引入Bootstrap CDN
   - 引入所有JS和CSS文件
   - 包含所有界面的HTML模板

2. **style.css：**

   - 全局样式变量定义
   - 各界面的样式
   - 游戏战场网格布局
   - 动画效果定义
   - 响应式媒体查询

3. **game.js：**

   - 游戏主循环（requestAnimationFrame）
   - 游戏状态管理（菜单、游戏中、暂停、结束）
   - 碰撞检测逻辑
   - 阳光掉落和收集逻辑
   - 游戏胜负判定

4. **plants.js：**

   - Plant基类定义
   - 各种植物子类（Sunflower, Peashooter, Wallnut, SnowPea, CherryBomb）
   - 植物种植、攻击、受伤、死亡逻辑
   - 子弹类定义和运动

5. **zombies.js：**

   - Zombie基类定义
   - 各种僵尸子类（NormalZombie, ConeZombie, BucketZombie）
   - 僵尸移动、攻击、受伤、死亡逻辑
   - 僵尸生成管理器

6. **levels.js：**

   - 所有关卡的配置数据（JSON格式）
   - 关卡解锁逻辑
   - 关卡加载函数

7. **storage.js：**

   - localStorage读写封装
   - 数据格式验证
   - 进度保存和加载
   - 重置功能

8. **ui.js：**

   - 页面切换控制
   - 按钮事件绑定
   - 弹窗显示和隐藏
   - 数据渲染到DOM
   - 响应式适配逻辑

### 3.3 核心技术实现要点

#### 3.3.1 游戏循环设计

```javascript
// 游戏主循环伪代码
let lastTime = 0;
let gameState = 'menu';  // menu, playing, paused, victory, defeat

function gameLoop(currentTime) {
  const deltaTime = currentTime - lastTime;
  lastTime = currentTime;
  
  if (gameState === 'playing') {
    updateGame(deltaTime);
    renderGame();
  }
  
  requestAnimationFrame(gameLoop);
}

function updateGame(deltaTime) {
  // 更新所有植物
  updatePlants(deltaTime);
  // 更新所有僵尸
  updateZombies(deltaTime);
  // 更新所有子弹
  updateProjectiles(deltaTime);
  // 碰撞检测
  checkCollisions();
  // 检查胜负条件
  checkGameOver();
  // 生成僵尸波次
  spawnZombies(deltaTime);
  // 掉落阳光
  spawnSunlight(deltaTime);
}
```

#### 3.3.2 网格系统实现

```javascript
// 网格配置
const GRID = {
  rows: 5,
  cols: 3,
  cellWidth: 100,   // 像素
  cellHeight: 120,  // 像素
  offsetX: 20,      // 左边距
  offsetY: 150,     // 顶部状态栏+植物栏高度
};

// 坐标转换函数
function screenToGrid(x, y) {
  const col = Math.floor((x - GRID.offsetX) / GRID.cellWidth);
  const row = Math.floor((y - GRID.offsetY) / GRID.cellHeight);
  return { row, col };
}

function gridToScreen(row, col) {
  const x = GRID.offsetX + col * GRID.cellWidth + GRID.cellWidth / 2;
  const y = GRID.offsetY + row * GRID.cellHeight + GRID.cellHeight / 2;
  return { x, y };
}

// 格子占用状态
const gridOccupied = Array(5).fill(null).map(() => Array(3).fill(null));
```

#### 3.3.3 碰撞检测优化

```javascript
// 基于行的碰撞检测（优化性能）
function checkCollisions() {
  // 子弹与僵尸碰撞
  projectiles.forEach(projectile => {
    const row = projectile.row;
    const zombiesInRow = zombies.filter(z => z.row === row);
    
    zombiesInRow.forEach(zombie => {
      if (isColliding(projectile, zombie)) {
        zombie.takeDamage(projectile.damage);
        if (projectile.type === 'ice') {
          zombie.slow(0.5);  // 减速50%
        }
        projectile.destroy();
      }
    });
  });
  
  // 僵尸与植物碰撞
  zombies.forEach(zombie => {
    const { row, col } = screenToGrid(zombie.x, zombie.y);
    const plant = gridOccupied[row][col];
    
    if (plant) {
      zombie.setTarget(plant);
      zombie.attack(plant);
    } else {
      zombie.clearTarget();
    }
  });
}
```

#### 3.3.4 移动端适配方案

```css
/* 响应式设计 */
/* 默认样式（移动端优先） */
:root {
  --cell-width: 90px;
  --cell-height: 100px;
  --font-size-base: 14px;
}

/* 平板设备 */
@media (min-width: 768px) {
  :root {
    --cell-width: 100px;
    --cell-height: 120px;
    --font-size-base: 16px;
  }
}

/* 桌面设备 */
@media (min-width: 1024px) {
  :root {
    --cell-width: 110px;
    --cell-height: 130px;
    --font-size-base: 18px;
  }
  
  /* 桌面设备宽度限制，避免太宽 */
  .game-container {
    max-width: 500px;
    margin: 0 auto;
  }
}

/* 触摸优化 */
.plant-card, .grid-cell, .sun {
  min-width: 44px;
  min-height: 44px;  /* iOS建议的最小触摸区域 */
}
```



```javascript
// 触摸事件处理
function initTouchEvents() {
  // 禁用双击缩放
  document.addEventListener('touchstart', (e) => {
    if (e.touches.length > 1) {
      e.preventDefault();
    }
  }, { passive: false });
  
  let lastTouchEnd = 0;
  document.addEventListener('touchend', (e) => {
    const now = Date.now();
    if (now - lastTouchEnd <= 300) {
      e.preventDefault();  // 防止双击缩放
    }
    lastTouchEnd = now;
  }, false);
  
  // 统一触摸和鼠标事件
  function getEventPosition(e) {
    if (e.touches && e.touches.length > 0) {
      return { x: e.touches[0].clientX, y: e.touches[0].clientY };
    }
    return { x: e.clientX, y: e.clientY };
  }
}
```

#### 3.3.5 性能优化策略

1. **对象池模式：** 重用僵尸和子弹对象，避免频繁创建销毁
2. **脏矩形渲染：** 只重绘变化的区域（可选，初期全量渲染）
3. **基于行的碰撞检测：** 僵尸只与同行对象检测碰撞
4. **requestAnimationFrame：** 使用浏览器原生动画API
5. **CSS动画：** 简单动画使用CSS transition，减少JS计算
6. **事件委托：** 减少事件监听器数量

### 3.4 视觉效果设计

#### 3.4.1 配色方案（简约现代风格）

```css
:root {
  /* 主色调 - 清新绿色系 */
  --color-primary: #4CAF50;      /* 主绿色 */
  --color-primary-light: #81C784; /* 浅绿色 */
  --color-primary-dark: #388E3C;  /* 深绿色 */
  
  /* 辅助色 */
  --color-secondary: #FFC107;     /* 阳光黄色 */
  --color-danger: #F44336;        /* 危险红色 */
  --color-success: #8BC34A;       /* 成功绿色 */
  
  /* 中性色 */
  --color-bg-light: #F5F5F5;      /* 浅背景 */
  --color-bg-dark: #333333;       /* 深背景 */
  --color-text-primary: #212121;  /* 主文字 */
  --color-text-secondary: #757575; /* 次文字 */
  --color-border: #E0E0E0;        /* 边框 */
  
  /* 游戏元素色 */
  --color-grass: #7CB342;         /* 草地 */
  --color-zombie: #8D6E63;        /* 僵尸棕色 */
  --color-sun: #FFD54F;           /* 太阳 */
}
```

#### 3.4.2 图标设计方案

**使用CSS绘制简单图标（避免加载大量图片）：**

```css
/* 太阳图标 - CSS绘制 */
.sun-icon {
  width: 40px;
  height: 40px;
  background: radial-gradient(circle, #FFF59D 0%, #FFD54F 50%, #FFA726 100%);
  border-radius: 50%;
  box-shadow: 0 0 10px rgba(255, 213, 79, 0.8);
  animation: sunGlow 2s infinite alternate;
}

@keyframes sunGlow {
  from { box-shadow: 0 0 10px rgba(255, 213, 79, 0.8); }
  to { box-shadow: 0 0 20px rgba(255, 213, 79, 1); }
}

/* 豌豆图标 */
.pea-icon {
  width: 20px;
  height: 20px;
  background: #7CB342;
  border-radius: 50%;
}
```

**使用Emoji图标（快速开发）：**

- 向日葵：🌻
- 豌豆射手：🌱 (+ 绿色背景)
- 坚果墙：🥜
- 寒冰射手：❄️
- 樱桃炸弹：🍒
- 普通僵尸：🧟
- 太阳：☀️

**优先级：** 初期使用Emoji快速开发，后期可替换为CSS绘制或SVG图标

#### 3.3.3 动画效果设计

```css
/* 植物种植动画 */
@keyframes plantGrow {
  0% { transform: scale(0); opacity: 0; }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); opacity: 1; }
}

.plant {
  animation: plantGrow 0.3s ease-out;
}

/* 僵尸摇晃动画 */
@keyframes zombieWalk {
  0%, 100% { transform: translateX(0) rotate(-2deg); }
  50% { transform: translateX(-2px) rotate(2deg); }
}

.zombie {
  animation: zombieWalk 1s infinite;
}

/* 子弹飞行 */
.projectile {
  transition: transform 0.1s linear;
}

/* 爆炸效果 */
@keyframes explode {
  0% { transform: scale(0); opacity: 1; }
  50% { transform: scale(1.5); opacity: 0.8; }
  100% { transform: scale(2); opacity: 0; }
}

/* 收集阳光动画 */
@keyframes collectSun {
  0% { transform: translate(0, 0) scale(1); opacity: 1; }
  100% { transform: translate(var(--target-x), var(--target-y)) scale(0.3); opacity: 0; }
}
```

### 3.5 部署配置

#### netlify.toml 配置文件

```toml
[build]
  publish = "."
  command = "echo 'No build required for static site'"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[build.environment]
  NODE_VERSION = "18"

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Cache-Control = "public, max-age=3600"

[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
```

#### .gitignore 配置

```
# 系统文件
.DS_Store
Thumbs.db

# 编辑器文件
.vscode/
.idea/
*.swp
*.swo

# 日志文件
*.log

# 临时文件
*.tmp
.cache/

# Netlify
.netlify/
```

## 四、开发计划

### 4.1 开发阶段划分

#### 第一阶段：项目初始化和基础框架（预计2天）

**任务清单：**

1. 创建项目文件结构
2. 编写 index.html 基础结构
3. 引入 Bootstrap 5.3 CDN
4. 创建基础CSS样式框架（style.css）
5. 实现页面状态切换系统（ui.js）
6. 实现主菜单界面和关卡选择界面
7. 配置Git仓库和.gitignore
8. 测试页面在PC和手机端的响应式表现

**交付物：**

- 完整的HTML页面结构
- 可切换的主菜单和关卡选择界面
- 响应式布局基础框架

#### 第二阶段：数据层和配置（预计1天）

**任务清单：**

1. 编写 levels.js - 定义所有5个关卡的配置数据
2. 编写 storage.js - 实现localStorage存储管理
3. 定义植物属性数据结构
4. 定义僵尸属性数据结构
5. 实现进度保存和加载功能
6. 实现重置进度功能
7. 编写关卡解锁逻辑

**交付物：**

- 完整的关卡配置数据
- 可用的数据存储系统
- 进度管理功能

#### 第三阶段：游戏核心系统（预计3天）

**任务清单：**

1. 编写 game.js 基础框架

   - 游戏主循环
   - 游戏状态管理
   - 时间管理系统

2. 实现网格系统

   - 网格布局渲染
   - 坐标转换函数
   - 格子占用状态管理

3. 实现阳光系统

   - 阳光掉落机制
   - 阳光收集交互
   - 阳光计数器更新

4. 实现植物选择栏

   - 植物卡片渲染
   - 选中状态切换
   - 冷却状态显示
   - 阳光不足提示

5. 实现种植系统

   - 植物预览
   - 种植确认
   - 阳光扣除
   - 冷却开始

**交付物：**

- 可运行的游戏主循环
- 可交互的网格系统
- 完整的阳光系统
- 可用的植物种植功能

#### 第四阶段：植物系统（预计2天）

**任务清单：**

1. 编写 plants.js
2. 实现Plant基类

   - 生命值管理
   - 受伤和死亡逻辑
   - 渲染函数

3. 实现各植物子类：

   - Sunflower（向日葵）- 生产阳光
   - Peashooter（豌豆射手）- 发射豌豆
   - Wallnut（坚果墙）- 防御
   - SnowPea（寒冰射手）- 发射冰豌豆
   - CherryBomb（樱桃炸弹）- 爆炸范围伤害

4. 实现子弹系统

   - Projectile类
   - 子弹移动和渲染
   - 冰冻效果实现

5. 实现移除植物功能（长按）

**交付物：**

- 完整的植物系统
- 各类植物的攻击机制
- 子弹飞行和碰撞逻辑

#### 第五阶段：僵尸系统（预计2天）

**任务清单：**

1. 编写 zombies.js
2. 实现Zombie基类

   - 移动逻辑
   - 攻击逻辑
   - 生命值管理
   - 减速效果
   - 渲染函数

3. 实现各僵尸子类：

   - NormalZombie（普通僵尸）
   - ConeZombie（路障僵尸）
   - BucketZombie（铁桶僵尸）

4. 实现僵尸生成管理器

   - 按波次生成
   - 随机行分配
   - 生成时间控制

5. 实现僵尸AI

   - 自动前进
   - 检测植物并攻击
   - 越界检测

**交付物：**

- 完整的僵尸系统
- 僵尸生成管理器
- 僵尸AI行为

#### 第六阶段：游戏逻辑整合（预计2天）

**任务清单：**

1. 实现碰撞检测系统

   - 子弹与僵尸碰撞
   - 僵尸与植物碰撞
   - 优化碰撞检测性能

2. 实现游戏胜负判定

   - 僵尸越界检测（失败）
   - 所有僵尸消灭（胜利）
   - 游戏结束处理

3. 实现关卡流程控制

   - 波次系统
   - 波次提示
   - 关卡加载
   - 关卡切换

4. 实现暂停功能

   - 暂停菜单
   - 游戏恢复
   - 重新开始
   - 返回主菜单

5. 完善游戏战斗界面UI

   - 顶部状态栏
   - 底部提示区
   - 波次进度显示

**交付物：**

- 完整的游戏逻辑流程
- 可玩的游戏关卡
- 胜负判定系统

#### 第七阶段：界面和交互完善（预计2天）

**任务清单：**

1. 完善游戏结果界面

   - 胜利界面设计和数据显示
   - 失败界面设计和提示
   - 下一关/重玩按钮

2. 完善游戏说明界面

   - 编写游戏规则说明
   - 植物和僵尸介绍
   - 操作指引

3. 实现关卡准备界面

   - 关卡信息展示
   - 可用植物展示
   - 植物详情查看

4. 完善所有操作提示

   - 种植提示
   - 阳光不足提示
   - 冷却中提示
   - 波次提示
   - 关卡解锁提示

5. 优化移动端交互体验

   - 触摸事件优化
   - 按钮大小调整
   - 防止误触

**交付物：**

- 完整的UI界面
- 完善的操作提示系统
- 优秀的移动端体验

#### 第八阶段：视觉效果和动画（预计1天）

**任务清单：**

1. 实现CSS动画效果

   - 植物种植动画
   - 僵尸行走动画
   - 子弹飞行效果
   - 爆炸动画
   - 阳光收集动画

2. 实现视觉反馈

   - 植物受伤闪烁
   - 僵尸受伤效果
   - 按钮点击反馈
   - 阳光闪烁提示

3. 完善图标和样式

   - 使用Emoji或CSS绘制图标
   - 统一视觉风格
   - 调整配色方案

4. 添加生命值条

   - 植物生命值条
   - 僵尸生命值条

**交付物：**

- 流畅的动画效果
- 完善的视觉反馈
- 美观的界面设计

#### 第九阶段：关卡调试和平衡性调整（预计2天）

**任务清单：**

1. 逐一测试5个关卡的可玩性
2. 调整关卡难度曲线

   - 僵尸数量
   - 波次间隔
   - 初始阳光

3. 平衡植物和僵尸属性

   - 攻击力
   - 生命值
   - 移动速度
   - 冷却时间

4. 测试关卡解锁逻辑
5. 测试进度保存和加载
6. 修复游戏逻辑BUG

**交付物：**

- 平衡的游戏难度
- 流畅的游戏体验
- 无重大BUG的游戏

#### 第十阶段：兼容性测试和优化（预计1天）

**任务清单：**

1. 测试各浏览器兼容性

   - Chrome
   - Firefox
   - Safari
   - Edge

2. 测试各设备适配

   - PC端（1920x1080, 1366x768）
   - 平板端（768x1024）
   - 手机端（375x667, 414x896）

3. 性能优化

   - 优化游戏循环
   - 减少DOM操作
   - 优化渲染性能

4. 加载速度优化

   - 压缩CSS和JS
   - 优化资源加载

5. 内存泄漏检查

**交付物：**

- 跨浏览器兼容的网站
- 多设备适配良好
- 优化的性能表现

#### 第十一阶段：文档和部署（预计1天）

**任务清单：**

1. 编写 README.md

   - 项目介绍
   - 游戏玩法
   - 技术栈说明
   - 本地开发指南
   - 部署说明

2. 编写代码注释

   - 关键函数注释
   - 复杂逻辑说明

3. 配置 netlify.toml
4. 部署到Netlify

   - 连接GitHub仓库
   - 配置构建设置
   - 测试部署结果

5. 域名配置（可选）
6. 最终测试和检查

**交付物：**

- 完整的项目文档
- 成功部署的网站
- 可访问的在线游戏

### 4.2 开发时间估算

**总开发时间：** 约17-20个工作日

**各阶段时间分配：**

- 基础框架：2天（12%）
- 数据层：1天（6%）
- 核心系统：3天（18%）
- 植物系统：2天（12%）
- 僵尸系统：2天（12%）
- 逻辑整合：2天（12%）
- 界面完善：2天（12%）
- 视觉效果：1天（6%）
- 关卡调试：2天（12%）
- 测试优化：1天（6%）
- 文档部署：1天（6%）

### 4.3 开发优先级

**P0（必须完成）：**

- 游戏核心循环和逻辑
- 植物和僵尸系统
- 至少3个可玩关卡
- 基础UI界面
- 数据存储功能
- 移动端适配

**P1（重要但可延后）：**

- 完整5个关卡
- 完善的动画效果
- 详细的游戏说明
- 性能优化

**P2（锦上添花）：**

- 音效系统（预留）
- 更多植物类型
- 成就系统
- 分享功能

## 五、质量保证

### 5.1 功能测试清单

**页面导航测试：**

- [ ] 主菜单各按钮可正常点击
- [ ] 关卡选择界面显示正确
- [ ] 页面切换流畅无卡顿
- [ ] 返回按钮功能正常

**游戏功能测试：**

- [ ] 植物可正常种植
- [ ] 阳光收集正常工作
- [ ] 僵尸正常生成和移动
- [ ] 植物攻击生效
- [ ] 碰撞检测准确
- [ ] 游戏胜负判定正确
- [ ] 暂停和恢复功能正常

**数据存储测试：**

- [ ] 进度正确保存
- [ ] 刷新后数据保留
- [ ] 重置进度功能正常
- [ ] 关卡解锁逻辑正确

**交互体验测试：**

- [ ] 所有按钮有点击反馈
- [ ] 操作提示显示正确
- [ ] 错误操作有提示
- [ ] 触摸操作响应灵敏

### 5.2 兼容性测试矩阵

| 设备类型 | 操作系统 | 浏览器 | 分辨率 | 测试状态 |

|---------|---------|--------|--------|---------|

| PC | Windows 10 | Chrome 最新版 | 1920x1080 | 待测试 |

| PC | Windows 10 | Edge 最新版 | 1920x1080 | 待测试 |

| PC | macOS | Safari 最新版 | 1440x900 | 待测试 |

| 手机 | iOS | Safari | 375x667 | 待测试 |

| 手机 | Android | Chrome | 414x896 | 待测试 |

| 平板 | iPad | Safari | 768x1024 | 待测试 |

### 5.3 性能指标

**目标性能指标：**

- 首屏加载时间：< 2秒
- FPS（游戏运行）：≥ 50 FPS
- 内存占用：< 100MB
- 操作响应延迟：< 100ms

## 六、用户体验设计要点

### 6.1 操作提示设计

**关键时刻的提示：**

1. **首次进入游戏：** 显示简短的新手引导："点击植物卡片，再点击格子种植"
2. **阳光不足：** 植物卡片显示"阳光不足"，并闪烁提示
3. **植物冷却中：** 显示倒计时，卡片变暗
4. **波次即将到来：** 底部提示"下一波僵尸即将到来！准备好你的植物"
5. **最终波提示：** "一大波僵尸正在接近！这是最后一波！"
6. **僵尸接近左侧：** 屏幕左侧红色闪烁警告
7. **关卡未解锁：** 提示"请先完成前面的关卡"
8. **进度已重置：** 提示"游戏进度已重置"

### 6.2 反馈机制

**视觉反馈：**

- 按钮点击：缩放动画（scale 0.95）
- 植物种植：生长动画
- 阳光收集：飞向计数器动画
- 僵尸受伤：红色闪烁
- 植物受伤：白色闪烁

**文本反馈：**

- 操作成功：绿色提示文字
- 操作失败：红色提示文字
- 重要信息：黄色醒目提示

### 6.3 错误处理

**常见错误处理：**

1. **localStorage不可用：** 提示用户启用浏览器存储，游戏仍可玩但不保存进度
2. **数据损坏：** 自动重置进度并提示用户
3. **浏览器不支持：** 显示提示："请使用现代浏览器访问"
4. **屏幕过小：** 提示旋转手机到竖屏模式

## 七、附录

### 7.1 技术参考资源

**Bootstrap 5.3 文档：**

- https://getbootstrap.com/docs/5.3/

**JavaScript参考：**

- MDN Web Docs: https://developer.mozilla.org/

**Canvas教程（如需使用）：**

- HTML5 Canvas Tutorial: https://www.w3schools.com/html/html5_canvas.asp

**Netlify部署文档：**

- https://docs.netlify.com/

### 7.2 游戏平衡性参考数据

**阳光经济模型：**

- 开局150阳光，可种植3个向日葵或1个向日葵+1个豌豆射手
- 向日葵15秒产50阳光，回本时间15秒
- 豌豆射手100阳光，2秒一发，DPS=10
- 推荐前30秒种植2-3个向日葵

**DPS计算：**

- 豌豆射手：20伤害 / 2秒 = 10 DPS
- 寒冰射手：20伤害 / 2.5秒 = 8 DPS（附带减速）
- 樱桃炸弹：1800伤害 / 一次性 = 秒杀大部分僵尸

**僵尸击杀时间：**

- 普通僵尸：200血 / 10 DPS = 20秒（1个豌豆射手）
- 路障僵尸：500血 / 10 DPS = 50秒（1个豌豆射手）
- 铁桶僵尸：1200血 / 10 DPS = 120秒（需2-3个射手）

### 7.3 未来扩展方向（预留）

**可扩展功能：**

1. 音效系统（种植、攻击、僵尸叫声）
2. 更多植物类型（双发射手、西瓜投手、地刺）
3. 更多僵尸类型（撑杆僵尸、气球僵尸）
4. 夜间关卡（需要蘑菇植物）
5. 无尽模式
6. 成就系统
7. 每日挑战
8. 排行榜（需后端）
9. 多语言支持（英文）
10. PWA支持（可安装到主屏幕）

---

**文档版本：** v1.0

**创建日期：** 2025-10-08

**文档状态：** 最终版，可开始开发

### To-dos

- [ ] 创建项目文件结构，编写 index.html 基础结构，引入 Bootstrap CDN，实现页面状态切换系统
- [ ] 编写 levels.js 和 storage.js，定义关卡配置和数据存储系统
- [ ] 实现游戏主循环、网格系统、阳光系统和植物选择种植功能
- [ ] 实现所有植物类、子弹系统和植物攻击机制
- [ ] 实现所有僵尸类、僵尸生成管理器和僵尸AI
- [ ] 整合碰撞检测、胜负判定、关卡流程和暂停功能
- [ ] 完善所有界面（结果、说明、准备界面）和操作提示系统
- [ ] 实现CSS动画效果、视觉反馈和美化界面
- [ ] 测试调试5个关卡，调整难度平衡性，修复BUG
- [ ] 兼容性测试、多设备适配测试和性能优化
- [ ] 编写README文档，配置netlify.toml，部署到Netlify